# Falco Driver 完整学习指南

> 从零开始掌握 Falco 驱动开发 - 面向 Linux 内核驱动和 eBPF 新手

## 📖 关于本指南

本学习指南旨在帮助 Linux 内核驱动开发新手深入理解 Falco 驱动的工作原理和代码实现，并能够将相关技术应用到自己的项目中。

### 适合人群

- 有基础的 C/C++ 编程经验
- 了解 Linux 基本操作
- 对内核驱动开发是新手
- 对 eBPF 了解有限
- 希望学习系统调用拦截和事件捕获技术

### 学习路径

本指南分为四个阶段，循序渐进：

```
第一阶段: 基础知识准备
    ↓
第二阶段: 代码结构分析
    ↓
第三阶段: 核心功能深入
    ↓
第四阶段: 实践指导
```

## 📑 文档导航

### [01. 基础架构 (01-basic-architecture.md)](./01-basic-architecture.md)

学习 Falco 驱动的基本概念和架构设计：

- **1.1 Falco 驱动的基本架构**
  - 三层架构设计
  - 核心工作原理
  - 数据流转过程

- **1.2 三种驱动模式详解**
  - Kernel Module（传统内核模块）
  - Legacy BPF Probe
  - Modern BPF Probe
  - 性能对比与选型建议

- **1.3 驱动与用户态的交互方式**
  - 环形缓冲区机制
  - mmap 内存映射
  - 事件轮询和读取

### [02. 代码结构分析 (02-code-structure.md)](./02-code-structure.md)

深入了解 Falco 驱动的代码组织：

- **2.1 主要源码目录详解**
  - driver/ - 内核模块核心代码
  - driver/bpf/ - Legacy BPF 实现
  - driver/modern_bpf/ - Modern BPF 实现
  - userspace/libscap/ - 用户态捕获库

- **2.2 关键数据结构详解**
  - 事件头（Event Header）
  - 环形缓冲区上下文
  - 事件填充器参数

- **2.3 事件捕获的核心流程**
  - 完整的事件捕获流程图
  - 从系统调用到用户态的完整路径

- **2.4 系统调用拦截的实现机制**
  - Tracepoint vs Kprobe vs eBPF
  - 三种驱动模式的拦截实现对比

### [03. 核心功能深入 (03-core-features.md)](./03-core-features.md)

掌握 Falco 驱动的核心功能实现：

- **3.1 系统调用钩子实现**
  - 系统调用过滤机制
  - TOCTOU（时间检查到使用）缓解
  - 事件映射表

- **3.2 事件缓冲区设计**
  - Per-CPU 环形缓冲区架构
  - 无锁读写算法
  - 内存映射实现

- **3.3 进程上下文信息收集**
  - 进程/线程信息获取
  - 命令行参数捕获
  - 环境变量和容器信息

- **3.4 网络事件捕获机制**
  - Socket 信息提取
  - 连接跟踪
  - 协议解析

- **3.5 文件系统操作监控**
  - 文件路径解析
  - 文件描述符跟踪
  - VFS 层监控

### [04. 实践指导 (04-practice-guide.md)](./04-practice-guide.md)

动手实践和调试技巧：

- **4.1 编译和加载 Falco 驱动**
  - 环境准备
  - 编译三种驱动模式
  - 加载和卸载

- **4.2 调试驱动代码**
  - 内核模块调试（printk、kgdb）
  - BPF 程序调试（bpftool、bpftrace）
  - 常用调试技巧

- **4.3 添加自定义系统调用监控**
  - 扩展事件表
  - 实现自定义 Filler
  - 用户态解析

- **4.4 修改事件数据结构**
  - 添加新参数
  - 协议版本兼容性
  - 测试验证

- **4.5 性能分析与优化**
  - 性能测试方法
  - 瓶颈识别
  - 优化技巧

### [05. 高级主题 (05-advanced-topics.md)](./05-advanced-topics.md)

深入探讨高级技术和架构设计：

- **5.1 多架构支持**
  - x86_64、ARM64、RISC-V 等
  - 系统调用兼容性处理
  - 架构特定优化

- **5.2 容器和 Kubernetes 集成**
  - 容器事件捕获
  - Namespace 处理
  - CRI 集成

- **5.3 安全性考虑**
  - 权限管理
  - 数据隐私保护
  - 对抗检测和绕过

- **5.4 与其他技术对比**
  - vs. Sysdig
  - vs. Auditd
  - vs. Tetragon
  - 技术选型建议

### [06. 学习资源 (06-resources.md)](./06-resources.md)

相关学习资源和社区支持：

- **官方资源**
  - Falco 官方文档
  - GitHub 仓库
  - 社区论坛

- **推荐阅读**
  - Linux 内核开发书籍
  - eBPF 学习资源
  - 系统调用相关文章

- **工具和库**
  - 开发工具链
  - 调试工具
  - 测试框架

- **实战项目**
  - 示例代码
  - 练习项目
  - 开源项目推荐

## 🚀 快速开始

如果你是第一次接触 Falco 驱动，建议按照以下顺序学习：

1. **第一天**：阅读 [01-basic-architecture.md](./01-basic-architecture.md)，理解三种驱动模式的原理和差异
2. **第二天**：阅读 [02-code-structure.md](./02-code-structure.md)，熟悉代码组织结构
3. **第三天**：阅读 [03-core-features.md](./03-core-features.md) 的前两节，掌握核心机制
4. **第四天**：跟随 [04-practice-guide.md](./04-practice-guide.md) 动手编译和调试
5. **第五天及以后**：根据兴趣深入学习特定主题

## 💡 学习建议

1. **理论与实践结合**：边学习边动手实验，加深理解
2. **阅读源代码**：文档是指引，源代码是真相
3. **使用调试工具**：学会使用 printk、bpftool 等工具追踪执行流程
4. **参与社区**：在 Falco 社区提问和分享经验
5. **循序渐进**：不要急于求成，扎实掌握每个阶段的知识

## 📝 版本信息

- **文档版本**：v1.0
- **基于 Falco 版本**：0.39.0+
- **内核版本**：Linux 3.10+ (kmod), 4.14+ (bpf), 5.8+ (modern_bpf)
- **最后更新**：2026-01-14

## 🤝 贡献

发现文档错误或有改进建议？欢迎：

1. 提交 Issue
2. 发起 Pull Request
3. 在社区讨论

## 📄 许可证

本学习指南采用 CC BY-SA 4.0 许可证。

---

**准备好开始学习了吗？** 👉 [开始第一章：基础架构](./01-basic-architecture.md)
